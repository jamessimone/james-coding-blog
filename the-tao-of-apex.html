<!DOCTYPE html><html><head><title>Joys Of Apex | The Tao Of Apex</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><meta name="robots" content="index,follow"><meta name="theme-color" content="#212121"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><link rel="shortcut icon" href="/joys-of-apex/favicon.ico"><link href="https://fonts.googleapis.com/css?family=Hind:400,700&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:300,400&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/icon?family=Material+Icons%7CMaterial+Icons+Outlined&amp;display=swap" rel="stylesheet"><style>
      body, input, button {
        font-family: 'Hind', sans-serif;
      }

      code, .hljs {
        font-family: 'Source Code Pro', 'Courier New', Courier, monospace;
      }

      .icon-font {
        font-family: 'Material Icons';
        font-weight: normal;
        font-style: normal;
        font-size: 24px;  /* Preferred icon size */
        display: inline-block;
        line-height: 1;
        text-transform: none;
        letter-spacing: normal;
        word-wrap: normal;
        white-space: nowrap;
        direction: ltr;
      
        /* Support for all WebKit browsers. */
        -webkit-font-smoothing: antialiased;
        /* Support for Safari and Chrome. */
        text-rendering: optimizeLegibility;
      
        /* Support for Firefox. */
        -moz-osx-font-smoothing: grayscale;
      
        /* Support for IE. */
        font-feature-settings: 'liga';
      }

      .icon-font.outline {
        font-family: 'Material Icons Outlined';
      }
    </style><link href="/joys-of-apex/styles/codedoc-styles.css" rel="stylesheet"><script async="" defer="" src="/joys-of-apex/bundle/codedoc-bundle.js"></script><meta property="og:image" content="./img/joys-of-apex-thumbnail.png"><script>window.githubConfig={"repo":"james-coding-blog","user":"jamessimone"}</script><style>.container{padding-top: 0 !important}</style><style>#-codedoc-toc { backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px) }</style><meta name="twitter:title" content="Joys Of Apex | The Tao Of Apex"><meta property="og:type" content="article"><meta property="og:title" content="Joys Of Apex | The Tao Of Apex"><meta name="keywords" content=""><meta property="blog-tags" content=""></head><body><header style="margin-left: 1rem">Read more at <a href="https://wwww.jamessimone.net">jamessimone.net</a>, or return to the <a href="/joys-of-apex/">homepage</a></header><div id="-codedoc-container" class="container"><script>window.source = {"base":"posts","path":"the-tao-of-apex.md","namespace":"/joys-of-apex","title":{"base":"Joys Of Apex","connector":" | "}}</script><div class="hero-0-0-8" style="margin-bottom: -156px"><img src="/joys-of-apex/img/the-joys-of-apex.png" class="image-0-0-9" data-hero=""><span class="caption-0-0-10"></span></div><marker><br>
<br>
<br>
<br>
<br>

</marker><h1 class="h-0-0-11 "><span style="color: green; 
      text-shadow: none; 
      font-size: 48px"><p>The Tao Of Apex</p></span></h1><script id="DVOubcNOYi">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("DVOubcNOYi", "kRzsgnV+B7EQTskbovy+YA==", {"src":"github","date":"2021-02-27T15:12:03.284Z"});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script><div hidden="" data-ignore-text="" data-meta-override-property="og:image"><p>./img/joys-of-apex-thumbnail.png</p></div><p>We owe our ability to understand abstractions in programming to philosophy; much as we owe a debt to mathematics for putting the theorems responsible for our code -- and computers -- to work into words. Consider the immortal words present in the Tao:</p><blockquote><p>A well-shut door will stay closed without a latch. Skillful fastening will stay tied without knots.</p></blockquote><p>One does not simply (walk into Mordor) build a door that works well. A factory for doors cannot provide you with the quality of worksmanship and perfect fit that something custom can provide. This bespeaks the utmost importance placed on domain knowledge when it comes to making code work well for an organization; our perfectly coded door comes from our knowledge of the space in which the door will be placed.</p><p>On the subject of knots, there is an implicit parallel to how well-produced, loosely coupled code works. Indeed, in our day-to-day journeys through code we haven't written, one hears the following epithet slung around frequently: <em>spaghetti code</em>. That scornful phrase comes, etymologically, from the very knots mentioned in the Tao! For me, it brings to mind the scene in <em>Maniac Magee</em> where the hero unties a knot that has stymmied the town for decades. Untying knots in code? We know that as refactoring.</p><p>The Tao also says:</p><blockquote><p>Advancing in the Tao seems like regression. Settling into the Tao seems rough.</p></blockquote><p>Becoming knowledgeable in any subject matter involves quite a bit of work. Becoming knowledgable about Salesforce development comes with many caveats:</p><ul><li>it helps to already have a broad understanding of how browsers work, and how frontend development proceeded on the web over the past decade (the eventual move from server-side to client-side rendering, for better or for worse). In this way, understanding how Visual Force, Aura, and Lightning Web Components work becomes much easier</li><li>it helps to understand the history of the company as a whole, and how declarative automation is frequently used as the selling point; this gives you the context necessary to understand obscure workarounds put in place between old Workflow Rules, more recent Process Builders, and now (thankfully) the increasingly sane automations produced by Flow</li><li>having a background in computer science helps, but in particular having a strong working knowledge of databases helps immensely. Triggers in Apex are just an abstraction over Oracle (or SQL) database triggers</li></ul><p>These things are "nice to haves." They aren't necessary or required by any means; however, I think that because people start to investigate the Salesforce ecosystem from the top down, they're frequently either scared off or unimpressed by the knowledge necessary and the tooling that exists.</p><p>There is a <em>flow</em> that occurs when you start to get comfortable developing in this ecosystem. "Flow" as a state of being is also an abstract concept as much a part of the Tao -- and many subsequent generations of books -- as it is something talked about in sports, in programmaing, and in life:</p><blockquote><p>Do without "doing" - Lao Tzu, Tao Te Ching</p></blockquote><p>When you're in the programming <em>zone</em>, it doesn't matter what language you're writing code in. You're no longer really even thinking about what you're doing; you're just iterating toward a vague goal that rapidly materializes. Today, I'd like to explore that zone -- similar to <a href="/joys-of-apex/idiomatic-salesforce-apex">Idiomatic Apex</a> and <a href="/joys-of-apex/naming-matters-in-apex">Naming Matters In Apex</a> in the sense that we'll be examining some common pitfalls I've seen in codebases. I call them "pitfalls" because drudgery keeps us from getting into the zone; as such, we empower ourselves to enter into a flow state more frequently when we're taking advantage of the standard library when that enables us to do our jobs more easily.</p><h2 id="getting-into-the-programming-zone" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Getting Into The Programming Zone</h2><p>How do we enter into a flow state while programming? There's no one right way. Personally, I find that establishing guard rails allows me to get in the zone quickly. I start by writing a failing test for the functionality I'm looking to develop. As well, when I uncover what I like to refer to as "poisonous code", I try to refactor it quickly (whenever possible); I also add tests to ensure that my refactorings aren't breaking the pre-existing nature of the code.</p><p>Here's an extremely simple example from several years ago. While working on an ecommerce site that wanted to host image galleries specific to product reviews, I found that there were instances of whitespace within the <code>String</code>s I was working with that needed to be sanitized so that the product in question could correctly be keyed to its reviews (and the images associated with them). There was already a utilities directory in our codebase, and a file dedicated to string helpers; in it, I found this gem:</p><pre class=""><code class="typescript -codedoc-code-snippet code-0-0-14" tabindex="0"><span class="wmbar-0-0-19"><span></span><span></span><span></span><span></span></span><div class="line-0-0-18  -codedoc-code-line" data-content="const removeLastNCharacters = (string: string, number: number) => {" id="code1-l1"><span class="lineCounter-0-0-15 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">const</span> <span class="token function-variable function">removeLastNCharacters</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="  var stringToRemove = new RegExp(&quot;.{&quot; + number + &quot;}$&quot;, &quot;i&quot;);" id="code1-l2"><span class="lineCounter-0-0-15 -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">var</span> stringToRemove <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">".{"</span> <span class="token operator">+</span> <span class="token builtin">number</span> <span class="token operator">+</span> <span class="token string">"}$"</span><span class="token punctuation">,</span> <span class="token string">"i"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="  return string.replace(stringToRemove, &quot;&quot;);" id="code1-l3"><span class="lineCounter-0-0-15 -codedoc-line-counter">3<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">return</span> <span class="token builtin">string</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>stringToRemove<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="};" id="code1-l4"><span class="lineCounter-0-0-15 prim -codedoc-line-counter">4<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token punctuation">}</span><span class="token punctuation">;</span></div><br></code></pre><p>ðŸ˜®. First of all -- it costs CPU cycles to compile regular expressions. They should always be constants for that reason. Re-declaring the regex in this case is needlessly wasteful. That's more of an aside -- this method is insane. There's no need for a dense and hard to understand regular expression -- removing characters from strings is a part of the basic JavaScript library. In keeping to my word, I first added in a test (which didn't exist previously) to validate that the existing code worked:</p><pre class=""><code class="typescript -codedoc-code-snippet code-0-0-14" tabindex="0"><span class="wmbar-0-0-19"><span></span><span></span><span></span><span></span></span><div class="line-0-0-18  -codedoc-code-line" data-content="import { removeLastNCharacters } from &quot;../strings&quot;;" id="code2-l1"><span class="lineCounter-0-0-15 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">import</span> <span class="token punctuation">{</span> removeLastNCharacters <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"../strings"</span><span class="token punctuation">;</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="" id="code2-l2"><span class="lineCounter-0-0-15 -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="describe(&quot;Strings&quot;, () => {" id="code2-l3"><span class="lineCounter-0-0-15 -codedoc-line-counter">3<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">"Strings"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="  it(&quot;should remove last n characters&quot;, () => {" id="code2-l4"><span class="lineCounter-0-0-15 -codedoc-line-counter">4<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"should remove last n characters"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="    const startingString = &quot;blablaremovelast5&quot;;" id="code2-l5"><span class="lineCounter-0-0-15 prim -codedoc-line-counter">5<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    <span class="token keyword">const</span> startingString <span class="token operator">=</span> <span class="token string">"blablaremovelast5"</span><span class="token punctuation">;</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="    const expectedEndingString = &quot;blablaremove&quot;;" id="code2-l6"><span class="lineCounter-0-0-15 -codedoc-line-counter">6<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    <span class="token keyword">const</span> expectedEndingString <span class="token operator">=</span> <span class="token string">"blablaremove"</span><span class="token punctuation">;</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="" id="code2-l7"><span class="lineCounter-0-0-15 -codedoc-line-counter">7<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="    const actualEndingString = removeLastNCharacters(startingString, 5);" id="code2-l8"><span class="lineCounter-0-0-15 -codedoc-line-counter">8<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    <span class="token keyword">const</span> actualEndingString <span class="token operator">=</span> <span class="token function">removeLastNCharacters</span><span class="token punctuation">(</span>startingString<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="    expect(expectedEndingString).toEqual(actualEndingString);" id="code2-l9"><span class="lineCounter-0-0-15 -codedoc-line-counter">9<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    <span class="token function">expect</span><span class="token punctuation">(</span>expectedEndingString<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span>actualEndingString<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="  });" id="code2-l10"><span class="lineCounter-0-0-15 prim -codedoc-line-counter">10<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="});" id="code2-l11"><span class="lineCounter-0-0-15 prim -codedoc-line-counter">11<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br></code></pre><p>Not my finest work, but it gets the job done. With that done, I was free to perform the single most satisfying refactoring in my career:</p><pre class=""><code class="diff -codedoc-code-snippet code-0-0-14" tabindex="0"><span class="wmbar-0-0-19"><span></span><span></span><span></span><span></span></span><div class="line-0-0-18  -codedoc-code-line" data-content="const removeLastNCharacters = (string: string, number: number) => {" id="code3-l1"><span class="lineCounter-0-0-15 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>const removeLastNCharacters = (string: string, number: number) =&gt; {</div><br><div class="line-0-0-18  -codedoc-code-line" data-content="-  var stringToRemove = new RegExp(&quot;.{&quot; + number + &quot;}$&quot;, &quot;i&quot;);" id="code3-l2"><span class="lineCounter-0-0-15 -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  var stringToRemove = new RegExp(".{" + number + "}$", "i");</span></span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="-  return string.replace(stringToRemove, &quot;&quot;);" id="code3-l3"><span class="lineCounter-0-0-15 -codedoc-line-counter">3<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token prefix deleted">-</span><span class="token line">  return string.replace(stringToRemove, "");</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="+  return string.slice(0, string.length - number);" id="code3-l4"><span class="lineCounter-0-0-15 -codedoc-line-counter">4<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  return string.slice(0, string.length - number);</span></span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="};" id="code3-l5"><span class="lineCounter-0-0-15 prim -codedoc-line-counter">5<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>};</div><br></code></pre><p>As <a href="https://github.com/surajp/">Suraj</a> noted while reviewing this excerpt, there's indeed a method to the madness in keeping this as a function; it can be easy to forget whether it's <code>splice</code> or <code>slice</code> that you're looking to use for this functionality.</p><p>Though this refactor was only tangentially related to the feature I had actually been tasked with working on, it added test coverage and fixed a nasty piece of code at the same time. It immediately put me into the zone, and being in that flow accelerated my pace of development on what I was actually working on. That I remember it fondly to this day speaks to the empowering nature of iterating on code. Keeping a codebase clean, or improving the existing quality of an older system, gives us the chance to get in small wins throughout the day; those victories help carry us through the harder times of grokking the seemingly alien intent of departed developers (or the difficulties present in implementing new features in a complicated existing system).</p><p>Does the idea of detouring from your existing responsibilities seem frightening? Remember what the Tao has to say about strategy:</p><blockquote><p>I prefer to be able to move, rather than be in a fixed position. I prefer to retreat a foot rather than advancing an inch.</p></blockquote><p>There's a reason that people talk about the power of lateral thinking. Sometimes the trick to entering into a flow state is to just change the problem you're working on for a few moments. Writing tests helps, too -- even if you're not exactly familiar with how to go about writing a failing test, that kind of <em>lateral learning</em> can help you to enter into a flow state more easily. When I was first learning Lightning Web Components, I didn't know how to mock the results of an Apex method being referenced by my component -- so I went to the <a href="https://github.com/trailheadapps/lwc-recipes">Trailhead LWC repo</a> for some inspiration. After seeing how easy it was to register mocked data through Jest for <code>@wire</code> decorated functions, I was well on my way.</p><p>Sometimes in order to move forward, we have to take two steps back.</p><h2 id="embrace-the-unknown" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Embrace The Unknown</h2><p>What does the Tao have to teach us about being vulnerable while programming; in an industry so beset by big egos, how can we empower ourselves to keep learning when the first step in learning is admitting that you don't know the answer to something?</p><blockquote><p>There is nothing better than to know that you don't know. Not knowing, yet thinking you know -- this is sickness. Only when you are sick of being sick can you be cured ... the further you go, the less you know.</p></blockquote><p>Owning up to not knowing the answer to something empowers you to enter future flow states through the feeling of gratitude. Remaining grateful for the opportunities present to you as you keep programming keeps every day interesting. One of my founding tenets when I began writing <a href="/joys-of-apex/">The Joys Of Apex</a> was to create a place that celebrated the work that we do each day on the platform, in some small hope that even the most jaded writer of code might find some fun fact or tidbit here and enjoy the work they do <em>a little bit more</em>.</p><p>There is a great deal of uncertainty that goes into fulfilling feature requests for our employers and clients. This is the great wheel of software development:</p><ul><li>get asked to do something</li><li>learn about what will be necessary to implement said feature</li><li>decide to actually create something or to hook into something existing if the time/actual cost is deemed worth it</li><li>rinse and repeat</li></ul><p>There's a corollary to the above -- and it comes as a codebase matures. Code that was once fresh and filled with clarity and purpose is now guarded by conditionals; what was once a safe haven is now an overgrown garden. There's a reason I like to use the phrase: <strong>reduce, reuse, refactor</strong> -- these are the words we can use in almost any setting within the codebase to keep things fresh. And, indeed, we can see that the Tao knows about how small changes can become complicated and ingrained; it also offers a hint as to the path we must tread when dealing with what accumulates through many "small" changes being made:</p><blockquote><p>The difficult problems in life always start off being simple ... much ease turns into much difficulty. Therefore the sage treats things as though they were difficult, and hence never has difficulty.</p></blockquote><p>Remember that all code ages. The best things we write are revisited time and time again -- either for inspiration, or to keep them clean. Without maintenance, the tarnish sets in. Which leads us to ...</p><h2 id="tell-your-story-through-code" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Tell Your Story Through Code</h2><p>Good code works. <em>Great</em> code tells a story about <em>how</em> it works. This is something we've already discussed in <a href="/joys-of-apex/naming-matters-in-apex/">Naming Matters In Apex</a>, but it's worth repeating again -- sometimes the best code in the world is elevated to that status because of a well-placed comment. The Tao knows all about the illuminating power of a well-placed comment:</p><blockquote><p>The sage squares things without cutting, edges without separating; straightens without lining up, shines but does not glare.</p></blockquote><p>Consider the following segment, part of <a href="https://github.com/tsalb/lwc-utils/">LWC Utils' custom datatable component</a>:</p><pre class=""><code class="js -codedoc-code-snippet code-0-0-14" tabindex="0"><span class="wmbar-0-0-19"><span></span><span></span><span></span><span></span></span><div class="line-0-0-18  -codedoc-code-line" data-content="// from https://github.com/tsalb/lwc-utils/blob/master/utils-core/main/default/lwc/datatable/datatable.js" id="code4-l1"><span class="lineCounter-0-0-15 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token comment">// from https://github.com/tsalb/lwc-utils/blob/master/utils-core/main/default/lwc/datatable/datatable.js</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="" id="code4-l2"><span class="lineCounter-0-0-15 -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="// Keeps lexical scope correct" id="code4-l3"><span class="lineCounter-0-0-15 -codedoc-line-counter">3<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token comment">// Keeps lexical scope correct</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="handleEditableCellRendered = () => {" id="code4-l4"><span class="lineCounter-0-0-15 -codedoc-line-counter">4<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token function-variable function">handleEditableCellRendered</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="  // This event is emitted from every editable cell, which is why needs to be debounced" id="code4-l5"><span class="lineCounter-0-0-15 prim -codedoc-line-counter">5<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token comment">// This event is emitted from every editable cell, which is why needs to be debounced</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="  window.clearTimeout(this._delayEditableCellRendered);" id="code4-l6"><span class="lineCounter-0-0-15 -codedoc-line-counter">6<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  window<span class="token punctuation">.</span><span class="token function">clearTimeout</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_delayEditableCellRendered<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="  this._delayEditableCellRendered = setTimeout(() => {" id="code4-l7"><span class="lineCounter-0-0-15 -codedoc-line-counter">7<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">this</span><span class="token punctuation">.</span>_delayEditableCellRendered <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="    // Editable cells need these even if the pencil icon is not enabled" id="code4-l8"><span class="lineCounter-0-0-15 -codedoc-line-counter">8<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    <span class="token comment">// Editable cells need these even if the pencil icon is not enabled</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="    this._initializeLookupConfigData();" id="code4-l9"><span class="lineCounter-0-0-15 -codedoc-line-counter">9<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_initializeLookupConfigData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="    this._initializeRecordTypeIdData();" id="code4-l10"><span class="lineCounter-0-0-15 prim -codedoc-line-counter">10<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_initializeRecordTypeIdData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="  }, 500);" id="code4-l11"><span class="lineCounter-0-0-15 -codedoc-line-counter">11<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="};" id="code4-l12"><span class="lineCounter-0-0-15 prim -codedoc-line-counter">12<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token punctuation">}</span><span class="token punctuation">;</span></div><br></code></pre><p>The comments <em>absolutely make</em> this section of code readable!</p><ul><li>First off, we learn immediately why the function is declared with fat arrow syntax -- to keep <code>this</code> bound to the component as a whole</li><li>We also learn that the function needs to be debounced -- which, in and of itself is useful information, because the reader <em>may not even know what debouncing is until reading this!</em></li><li>There are prereqs scattered throughout the datatable, and the last comment informs the reader that there are two operations necessary for any editable cell</li></ul><p>Without those comments, the purpose of the function -- and the reason for its deviation in terms of style of declaration -- are obscured for the newer reader of JavaScript. Indeed, reading a comment like the first one shown can help the reader in many such future situations (especially in a consistent codebase): much as iterating through a list in reverse in Apex should be a sign that elements are going to be removed from the list, seeing a fat arrow function in JavaScript should telegraph to the reader: <em>we need to preserve the value of <code>this</code> here</em>.</p><p>In some circles (and here we return to the subject of ego ...), the expectation is that you have to be "at a certain level," to understand good code; that if you don't "get it," you're not worthy. Once again, the Tao to the rescue:</p><blockquote><p>True words are not fancy. Fancy words are not true ... the sage does not hoard. She gives people her surplus. Giving her surplus to others, she is enriched.</p></blockquote><p>One of the best things about reading <a href="https://github.com/tsalb">James Hou's code</a> comes from the obvious pains he takes in comments like the ones shown to give back. There's no ego involved with leaving a note to yourself -- and to other developers -- your rationale for doing something. As a result, his repositories have become a one-stop-shop for learning about LWC in particular, and modern Salesforce development in general.</p><p>Give your code a voice, and you set yourself up (and the ones that will come after you) for success. In writing this, it made me realize I needed to revise where I'd put a crucial comment in <a href="https://github.com/jamessimone/apex-rollup">Rollup</a>:</p><pre class=""><code class="java -codedoc-code-snippet code-0-0-14" tabindex="0"><span class="wmbar-0-0-19"><span></span><span></span><span></span><span></span></span><div class="line-0-0-18  -codedoc-code-line" data-content="private static List<SObject> getMetadataFromCache(SObject metadataRecord) {" id="code5-l1"><span class="lineCounter-0-0-15 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> <span class="token function">getMetadataFromCache</span><span class="token punctuation">(</span><span class="token class-name">SObject</span> metadataRecord<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="  // CMDT is read-only when returned from the cache" id="code5-l2"><span class="lineCounter-0-0-15 -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token comment">// CMDT is read-only when returned from the cache</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="  Map<String, SObject> metadataMap;" id="code5-l3"><span class="lineCounter-0-0-15 -codedoc-line-counter">3<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> metadataMap<span class="token punctuation">;</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="  switch on metadataRecord {" id="code5-l4"><span class="lineCounter-0-0-15 -codedoc-line-counter">4<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">switch</span> on metadataRecord <span class="token punctuation">{</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="    when Rollup__mdt rollupMeta {" id="code5-l5"><span class="lineCounter-0-0-15 prim -codedoc-line-counter">5<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    when <span class="token class-name">Rollup__mdt</span> rollupMeta <span class="token punctuation">{</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="      metadataMap = Rollup__mdt.getAll();" id="code5-l6"><span class="lineCounter-0-0-15 -codedoc-line-counter">6<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>      metadataMap <span class="token operator">=</span> <span class="token class-name">Rollup__mdt</span><span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="    }" id="code5-l7"><span class="lineCounter-0-0-15 -codedoc-line-counter">7<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="    when RollupControl__mdt rollupControl {" id="code5-l8"><span class="lineCounter-0-0-15 -codedoc-line-counter">8<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    when <span class="token class-name">RollupControl__mdt</span> rollupControl <span class="token punctuation">{</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="      metadataMap = RollupControl__mdt.getAll();" id="code5-l9"><span class="lineCounter-0-0-15 -codedoc-line-counter">9<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>      metadataMap <span class="token operator">=</span> <span class="token class-name">RollupControl__mdt</span><span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="    }" id="code5-l10"><span class="lineCounter-0-0-15 prim -codedoc-line-counter">10<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="  }" id="code5-l11"><span class="lineCounter-0-0-15 -codedoc-line-counter">11<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="  return metadataMap?.deepClone().values();" id="code5-l12"><span class="lineCounter-0-0-15 -codedoc-line-counter">12<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">return</span> metadataMap<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">deepClone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="}" id="code5-l13"><span class="lineCounter-0-0-15 prim -codedoc-line-counter">13<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token punctuation">}</span></div><br></code></pre><p>Instead of having the comment at the top, it belongs with the actual clone statement; it also deserves a bit more explanation:</p><pre class=""><code class="diff -codedoc-code-snippet code-0-0-14" tabindex="0"><span class="wmbar-0-0-19"><span></span><span></span><span></span><span></span></span><div class="line-0-0-18  -codedoc-code-line" data-content="private static List<SObject> getMetadataFromCache(SObject metadataRecord) {" id="code6-l1"><span class="lineCounter-0-0-15 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>private static List&lt;SObject&gt; getMetadataFromCache(SObject metadataRecord) {</div><br><div class="line-0-0-18  -codedoc-code-line" data-content="-  // CMDT is read-only when returned from the cache" id="code6-l2"><span class="lineCounter-0-0-15 -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  // CMDT is read-only when returned from the cache</span></span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="  Map<String, SObject> metadataMap;" id="code6-l3"><span class="lineCounter-0-0-15 -codedoc-line-counter">3<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> Map&lt;String, SObject&gt; metadataMap;</span></span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="  switch on metadataRecord {" id="code6-l4"><span class="lineCounter-0-0-15 -codedoc-line-counter">4<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token prefix unchanged"> </span><span class="token line"> switch on metadataRecord {</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="    when Rollup__mdt rollupMeta {" id="code6-l5"><span class="lineCounter-0-0-15 prim -codedoc-line-counter">5<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token prefix unchanged"> </span><span class="token line">   when Rollup__mdt rollupMeta {</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="      metadataMap = Rollup__mdt.getAll();" id="code6-l6"><span class="lineCounter-0-0-15 -codedoc-line-counter">6<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token prefix unchanged"> </span><span class="token line">     metadataMap = Rollup__mdt.getAll();</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="    }" id="code6-l7"><span class="lineCounter-0-0-15 -codedoc-line-counter">7<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token prefix unchanged"> </span><span class="token line">   }</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="    when RollupControl__mdt rollupControl {" id="code6-l8"><span class="lineCounter-0-0-15 -codedoc-line-counter">8<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token prefix unchanged"> </span><span class="token line">   when RollupControl__mdt rollupControl {</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="      metadataMap = RollupControl__mdt.getAll();" id="code6-l9"><span class="lineCounter-0-0-15 -codedoc-line-counter">9<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token prefix unchanged"> </span><span class="token line">     metadataMap = RollupControl__mdt.getAll();</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="    }" id="code6-l10"><span class="lineCounter-0-0-15 prim -codedoc-line-counter">10<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token prefix unchanged"> </span><span class="token line">   }</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="  }" id="code6-l11"><span class="lineCounter-0-0-15 -codedoc-line-counter">11<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token prefix unchanged"> </span><span class="token line"> }</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="+ // CMDT is read-only when returned from the cache" id="code6-l12"><span class="lineCounter-0-0-15 -codedoc-line-counter">12<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> // CMDT is read-only when returned from the cache</span></span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="+ // use &quot;deepClone&quot; to get access to mutable versions" id="code6-l13"><span class="lineCounter-0-0-15 -codedoc-line-counter">13<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token prefix inserted">+</span><span class="token line"> // use "deepClone" to get access to mutable versions</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="+ // of the CMDT records" id="code6-l14"><span class="lineCounter-0-0-15 -codedoc-line-counter">14<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token prefix inserted">+</span><span class="token line"> // of the CMDT records</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="  return metadataMap?.deepClone().values();" id="code6-l15"><span class="lineCounter-0-0-15 prim -codedoc-line-counter">15<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> return metadataMap?.deepClone().values();</span></span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="}" id="code6-l16"><span class="lineCounter-0-0-15 prim -codedoc-line-counter">16<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>}</div><br></code></pre><p>Ahhh. There we go. Also, while we're here -- this is an interesting and underexplored topic concerning <code>switch</code> statements and CMDT that I think is worth talking about. Because CMDT records have been exposed in Apex as implementing the common <code>SObject</code> interface, we can actually call this method using one of the two custom metadata records we expect:</p><pre class=""><code class="java -codedoc-code-snippet code-0-0-14" tabindex="0"><span class="wmbar-0-0-19"><span></span><span></span><span></span><span></span></span><div class="line-0-0-18  -codedoc-code-line" data-content="List<Rollup__mdt> rollupMetadata = getMetadataFromCache(new Rollup__mdt());" id="code7-l1"><span class="lineCounter-0-0-15 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Rollup__mdt</span><span class="token punctuation">&gt;</span></span> rollupMetadata <span class="token operator">=</span> <span class="token function">getMetadataFromCache</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Rollup__mdt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br></code></pre><p>You don't even need to cast the list to its specific type! Because we're able to spin up "empty" CMDT in-memory, we can take advantage of the syntax sugar built into Apex's <code>switch</code> statement. It's a shame that <code>switch</code> does not yet support the same operations for the generic <code>SObjectType</code> token (which is essentially what the "syntax sugar" in those <code>when</code> statements is doing). Let's look at two other ways of doing this:</p><pre class=""><code class="java -codedoc-code-snippet code-0-0-14" tabindex="0"><span class="wmbar-0-0-19"><span></span><span></span><span></span><span></span></span><div class="line-0-0-18  -codedoc-code-line" data-content="private static List<SObject> getMetadataFromCache(SObject metadataRecord) {" id="code8-l1"><span class="lineCounter-0-0-15 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> <span class="token function">getMetadataFromCache</span><span class="token punctuation">(</span><span class="token class-name">SObject</span> metadataRecord<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="  // comments omitted for brevity" id="code8-l2"><span class="lineCounter-0-0-15 -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token comment">// comments omitted for brevity</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="  Map<String, SObject> metadataMap;" id="code8-l3"><span class="lineCounter-0-0-15 -codedoc-line-counter">3<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> metadataMap<span class="token punctuation">;</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="  if(metadataRecord.getSobjectType() == Rollup__mdt.SObjectType) {" id="code8-l4"><span class="lineCounter-0-0-15 -codedoc-line-counter">4<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">if</span><span class="token punctuation">(</span>metadataRecord<span class="token punctuation">.</span><span class="token function">getSobjectType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Rollup__mdt<span class="token punctuation">.</span>SObjectType</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="    metadataMap = Rollup__mdt.getAll();" id="code8-l5"><span class="lineCounter-0-0-15 prim -codedoc-line-counter">5<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    metadataMap <span class="token operator">=</span> <span class="token class-name">Rollup__mdt</span><span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="  } else if(metadataRecord.getSObjectType() == RollupControl__mdt.SObjectType) {" id="code8-l6"><span class="lineCounter-0-0-15 -codedoc-line-counter">6<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>metadataRecord<span class="token punctuation">.</span><span class="token function">getSObjectType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">RollupControl__mdt<span class="token punctuation">.</span>SObjectType</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="    metadataMap = Rollup__mdt.getAll();" id="code8-l7"><span class="lineCounter-0-0-15 -codedoc-line-counter">7<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    metadataMap <span class="token operator">=</span> <span class="token class-name">Rollup__mdt</span><span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="  }" id="code8-l8"><span class="lineCounter-0-0-15 -codedoc-line-counter">8<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="  return metadataMap?.deepClone().values();" id="code8-l9"><span class="lineCounter-0-0-15 -codedoc-line-counter">9<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">return</span> metadataMap<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">deepClone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="}" id="code8-l10"><span class="lineCounter-0-0-15 prim -codedoc-line-counter">10<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token punctuation">}</span></div><br></code></pre><p>Of course, now that we're navigating away from the syntax sugar present in the <code>switch</code> statement, we can do better by changing the method signature:</p><pre class=""><code class="java -codedoc-code-snippet code-0-0-14" tabindex="0"><span class="wmbar-0-0-19"><span></span><span></span><span></span><span></span></span><div class="line-0-0-18  -codedoc-code-line" data-content="private static List<SObject> getMetadataFromCache(SObjectType metadataType) {" id="code9-l1"><span class="lineCounter-0-0-15 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> <span class="token function">getMetadataFromCache</span><span class="token punctuation">(</span><span class="token class-name">SObjectType</span> metadataType<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="  Map<String, SObject> metadataMap;" id="code9-l2"><span class="lineCounter-0-0-15 -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> metadataMap<span class="token punctuation">;</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="  if (metadataType == Rollup__mdt.SObjectType) {" id="code9-l3"><span class="lineCounter-0-0-15 -codedoc-line-counter">3<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>metadataType <span class="token operator">==</span> <span class="token class-name">Rollup__mdt<span class="token punctuation">.</span>SObjectType</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="    metadataMap = Rollup__mdt.getAll();" id="code9-l4"><span class="lineCounter-0-0-15 -codedoc-line-counter">4<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    metadataMap <span class="token operator">=</span> <span class="token class-name">Rollup__mdt</span><span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="  } else if (metadataType == RollupControl__mdt.SObjectType) {" id="code9-l5"><span class="lineCounter-0-0-15 prim -codedoc-line-counter">5<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>metadataType <span class="token operator">==</span> <span class="token class-name">RollupControl__mdt<span class="token punctuation">.</span>SObjectType</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="    metadataMap = RollupControl__mdt.getAll();" id="code9-l6"><span class="lineCounter-0-0-15 -codedoc-line-counter">6<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    metadataMap <span class="token operator">=</span> <span class="token class-name">RollupControl__mdt</span><span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="  }" id="code9-l7"><span class="lineCounter-0-0-15 -codedoc-line-counter">7<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="  // CMDT is read-only when returned from the cache" id="code9-l8"><span class="lineCounter-0-0-15 -codedoc-line-counter">8<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token comment">// CMDT is read-only when returned from the cache</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="  // use &quot;deepClone&quot; to get access to mutable versions" id="code9-l9"><span class="lineCounter-0-0-15 -codedoc-line-counter">9<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token comment">// use "deepClone" to get access to mutable versions</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="  // of the CMDT records" id="code9-l10"><span class="lineCounter-0-0-15 prim -codedoc-line-counter">10<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token comment">// of the CMDT records</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="  return metadataMap?.deepClone().values();" id="code9-l11"><span class="lineCounter-0-0-15 -codedoc-line-counter">11<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">return</span> metadataMap<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">deepClone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-18  -codedoc-code-line" data-content="}" id="code9-l12"><span class="lineCounter-0-0-15 prim -codedoc-line-counter">12<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token punctuation">}</span></div><br></code></pre><p>So ... now we really come to the crux of it -- which method is best? The <code>switch</code> statement <em>looks</em> nice, but in reality coupling the method signature to an <code>SObject</code> type obscures what's actually happening within the method itself. In this case, I'm going to have to go with the if statement, because it won't engender any questions later on when myself (or somebody else!) visits this code. And, in weighing the pros and cons of each approach, I found myself in a flow state unexpectedly; I didn't so much make the decision about which method was better so much as it came to me.</p><hr><h2 id="tao-closing-thoughts" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Tao Closing Thoughts</h2><p>What gets you into the flow of programming? I don't think there's one consistent way that works for people -- some have a lot of success in achieving a flow state by watching videos about programming; some thrive on getting inspiration from books. Sometimes the easiest way for me to achieve a flow state is to simply start refactoring something, or writing tests to prove a hypothesis. Some of the best ideas on this blog -- <a href="/joys-of-apex/extendable-apis/">Dynamic APIs</a> and dynamically scaling <a href="/joys-of-apex/batchable-and-queueable-apex">Batchable &amp; Queueable Apex</a> came out of ideas generated <em>while in the midst of doing something else</em>. Even if you don't have a chance at that exact moment to make something of the thought you're having, write it down, put a note in your phone, or verbalize the thought so you won't lose track of it later.</p><p>As well, keep track of how you get into the zone, and when those moments of flow occur. Just as we try to follow steps to reproduce bugs as they're reported, so too can you more consistently achieve a flow state once you know how to get yourself ticking. Achieving these elevated moments of mental clarity and excitement can also help with the drudgery that I mentioned at the start of this article; sometimes you need to save the particularly tedious work till you're in such a state. Cultivating a satisfying and consistent repertoire (and this frequently extends outside of programming as well; almost every time I'm "stuck" on something, I figure out how to proceed while on a run, and only after I've stopped consciously thinking about the problem at hand) creates mental space where you can thrive, and help others thrive as well.</p><p>--</p><h1 id="postscript" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Postscript</h1><p>Tuesday, February 16th 2021 was my last day with Publicis Sapient. After two years of consulting, I was approached by a team at Salesforce about going to work for them, and I'm excited to announce that next week I'll start my new job there. I have nothing but positive things to say about my time at Publicis; they have a great Salesforce team, and I was extended many opportunities to lead during my brief tenure there. That I leave behind some newfound friends is a bittersweet part of this change, but it's long been a dream of mine to work for Salesforce. I expect that I will continue to author posts here; thanks for staying with me on this journey, and I hope this post leaves you with some good food for thought.</p><p>The original version of <a href="https://www.jamessimone.net/blog/joys-of-apex/the-tao-of-apex/">The Tao Of apex can be read on my blog</a> - it is mirrored here for your enjoyment!</p><div class="contentnav-0-0-7" data-no-search=""><a href="#getting-into-the-programming-zone" class="h2" data-content-highlight="getting-into-the-programming-zone">Getting Into The Programming Zone</a><a href="#embrace-the-unknown" class="h2" data-content-highlight="embrace-the-unknown">Embrace The Unknown</a><a href="#tell-your-story-through-code" class="h2" data-content-highlight="tell-your-story-through-code">Tell Your Story Through Code</a><a href="#tao-closing-thoughts" class="h2" data-content-highlight="tao-closing-thoughts">Tao Closing Thoughts</a><a href="#postscript" class="h1" data-content-highlight="postscript">Postscript</a></div></div><div id="-codedoc-toc" class="toc-0-0-4"><div class="content-0-0-5"><p><a href="/joys-of-apex/">Home</a>
<a href="/joys-of-apex/advanced-logging-using-nebula-logger">Advanced Logging Using Nebula Logger</a>
<a href="/joys-of-apex/apex-logging-service">Apex Logging Service</a>
<a href="/joys-of-apex/apex-object-oriented-basics">Apex Object-Oriented Basics</a>
<a href="/joys-of-apex/batchable-and-queueable-apex">Batchable And Queueable Apex</a>
<a href="/joys-of-apex/building-a-better-singleton">Building A Better Singleton</a>
<a href="/joys-of-apex/continuous-integration-with-sfdx">Continuous Integration With SFDX</a>
<a href="/joys-of-apex/dependency-injection-factory-pattern">Dependency Injection &amp; Factory Pattern</a>
<a href="/joys-of-apex/enum-apex-class-gotchas">Enum Apex Class Gotchas</a>
<a href="/joys-of-apex/extendable-apis">Extendable Apis</a>
<a href="/joys-of-apex/formula-date-issues">Formula Date Issues</a>
<a href="/joys-of-apex/future-method-callout-callback">Future Methods, Callouts &amp; Callbacks</a>
<a href="/joys-of-apex/idiomatic-salesforce-apex">Idiomatic Salesforce Apex</a>
<a href="/joys-of-apex/intro">Introduction &amp; Testing Philosophy</a>
<a href="/joys-of-apex/lazy-iterators">Lazy Iterators</a>
<a href="/joys-of-apex/lightweight-trigger-handler">Lightweight Trigger Handler</a>
<a href="/joys-of-apex/lwc-composable-modal">LWC Composable Modal</a>
<a href="/joys-of-apex/lwc-composable-pagination">LWC Composable Pagination</a>
<a href="/joys-of-apex/lwc-custom-path">LWC Custom Lead Path</a>
<a href="/joys-of-apex/mocking-dml">Mocking DML</a>
<a href="/joys-of-apex/react-versus-lightning-web-components">React Versus Lightning Web Components</a>
<a href="/joys-of-apex/refactoring-tips-and-tricks">Refactoring Tips &amp; Tricks</a>
<a href="/joys-of-apex/replacing-dlrs-with-custom-rollup">Replacing DLRS With Custom Rollup</a>
<a href="/joys-of-apex/repository-pattern">Repository Pattern</a>
<a href="/joys-of-apex/set-timeout-and-implementing-delays">setTimeout &amp; Implementing Delays</a>
<a href="/joys-of-apex/sorting-and-performance-in-apex">Sorting And Performance In Apex</a>
<a href="/joys-of-apex/test-driven-development-example">Test Driven Development Example</a>
<a href="/joys-of-apex/testing-custom-permissions">Testing Custom Permissions</a>
<a href="/joys-of-apex/the-tao-of-apex">The Tao Of Apex</a>
<a href="/joys-of-apex/writing-performant-apex-tests">Writing Performant Apex Tests</a></p><p><br><br></p><p><a href="https://www.jamessimone.net/">Read more tech articles</a></p></div></div><div class="footer-0-0-3"><div class="left"><script id="KGaJfSAgzN">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("KGaJfSAgzN", "BWW0vHR4333HbDOiwZ67JA==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script></div><div class="main"><div class="inside"></div></div><div class="right"><script id="HYOdkVLFsg">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("HYOdkVLFsg", "6yEdMfRRlNsUBKSBOTazFg==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script></div></div><script id="hCTmmVJjEP">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("hCTmmVJjEP", "wh9V9isakhdwzlz9ZUjvyw==", {"namespace":"/joys-of-apex"});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script></body></html>